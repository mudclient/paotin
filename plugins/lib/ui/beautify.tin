#var lib_ui_beautify[META] {
    {NAME}      {ç¾åŒ–æ’ä»¶}
    {DESC}      {ç¾åŒ–ä½ çš„ TinTin++ï¼Œå¯¹é½ä½ çš„è¡¨æ ¼ã€‚}
    {AUTHOR}    {æ‹…å­ç‚®}
};

#function {lib_ui_beautify.Init} {
    #class data/lib/ui/beautify open;
    #var beautify-switch {OFF};
    #var beautify-eol-mark {<g03>.};
    #class data/lib/ui/beautify close;
    beautify.On;
    #return true;
};

#var beautify-table {
    {â”Œ|â”|â•­|â•“|â””|â”–|â•°|â•™}                                   {â”€}
    {â”€|â”¬|â”­|â”°|â”±|â•¥}                                         {â”€}
    {â”œ|â”|â”Ÿ|â” |â•Ÿ}                                            {â”€}
    {â”¼|â•|â•€|â•‚|â”½|â•ƒ|â•…|â•‰|â•«}                                {â”€}
    {â”´|â”µ|â”¸|â”¹|â•¨}                                            {â”€}
    {â”|â”|â”—|â”•}                                               {â”}
    {â”|â”³|â”²|â”¯|â”®}                                            {â”}
    {â”£|â”¢|â”¡|â”}                                               {â”}
    {â•‹|â•‡|â•ˆ|â”¿|â•Š|â•†|â•„|â”¾}                                   {â”}
    {â”»|â”º|â”·|â”¶}                                               {â”}
    {â•”|â•¦|â• |â•¬|â•š|â•©|â•|â•’|â•¤|â•|â•ª|â•˜|â•§}                    {â•}

    {â”‚|â”ƒ|â•‘|â”†|â”‡|â”Š|â”‹|â”¤|â”¨|â”«|â•£|â•¢|â•¡}                    {left-align}
    {â”|â”“|â”’|â•®|â•—|â”˜|â”›|â”š|â•¯|â•|â•²|â•±}                       {left-align}

    {â– |â€–|â–‰|â–Š|â–‹|â–Œ|â–|â–|â–|â—¢|â—£|â—¥|â—¤|â–“}                 {left-align}
    {â–|â–‚|â–ƒ|â–„|â–…|â–†|â–‡|â–ˆ|â–€|â–”|â”„|â”…|â”ˆ|â”‰|â€”}              {double}

    {â–¼|â–³|â–¡|â—‡|â—†|â˜†|â˜…|â—|âŠ™|â—‹|â—|Î˜|âŠ•|Ã—|Â·|âˆ¶|âˆ´|âˆ·}     {left-align}
    {â‰¤|â‰§|â‰¥|â‰®|â‰¯|â†™|â†˜|â†—|â†–|â†|â†‘|â†’|â†“|âˆ¨|âˆ§|â‰Œ|â•³}        {left-align}
    {â€»|Î¨|Ğ–|Î¾|Ñ„|âˆ©|âŠ¥|â™€|âˆ|â‰ˆ|âˆš|âŒ’|Î©|Â¤|Å|î‹ª|Ïˆ|Î¶}     {left-align}
    {â‘ |â‘¡|â‘¢|â‘£|â‘¤|â‘¥|â‘¦|â‘§|â‘¨|â‘©}                             {left-align}

    {â€œ|â€˜}                                                     {right-align}
    {â€|â€™|â€¦}                                                  {left-align}

    {â­•ï¸|ğŸ|ğŸŒŠ|ğŸ”¥|ğŸ­|ğŸ€|ğŸ”…}                                      {left-align}
};

#alias {beautify.On} {
    #class beautify-sub kill;
    #class beautify-sub open;

    #local charset {};
    #foreach {*{beautify-table[]}} {charset} {
        #local type {${beautify-table[$charset]}};
        #switch {"$type"} {
            #case {"double"}        {#substitute {{$charset}} {%%1%%1}};
            #case {"left-align"}    {#substitute {{$charset}} {%%1 }};
            #case {"right-align"}   {#substitute {{$charset}} { %%1}};
            #default                {#line sub var #substitute {{$charset}} {%%1$type}};
        };
    };

    #substitute {%S%!s{https?://[[:graph:]]+}\s*{\S|$}} {%%1 %%2 %%3};

    #nop è¡Œå°¾ç©ºæ ¼å› ä¸ºè‚‰çœ¼ä¸å¯è§å› æ­¤å¸¸å¸¸å¯¼è‡´æ— æ³•åŒ¹é…è§¦å‘ã€‚è¿™é‡ŒæŠŠå®ƒå¯è§†åŒ–ä¸€ä¸‹ã€‚;
    #action {~^%*%+1S%+1..s%c{|ID=beautify}$} {
        #line ignore #showme {@Beautify{{%%1%%2%%3}}$beautify-eol-mark};
        #line gag;
    } {9.999};

    #class beautify-sub close;

    #var beautify-switch {ON};
    okLog å®½å­—ç¬¦ç¾åŒ–å·²å¯ç”¨ã€‚;
    warnLog å‡ºäºç¾åŒ–éœ€è¦ï¼Œæ¥ä¸‹æ¥ä½ åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„å†…å®¹å¯èƒ½å’ŒæœåŠ¡å™¨å®é™…ä¼ é€çš„å†…å®¹ä¸ä¸€è‡´ã€‚;
    warnLog è¿™å¯èƒ½ä¼šç»™ç¼–å†™è§¦å‘å¸¦æ¥å›°æ‰°ï¼Œæ­¤æ—¶ä½ å¯ä»¥é€šè¿‡å¿«æ·é”®æˆ–è€… beautify.Off æš‚æ—¶ç¦ç”¨ç¾åŒ–ã€‚;

    prompt.Set {{beautify}{<120>å·²å¯ç”¨}};
    prompt.refresh;
};

#alias {beautify.Off} {
    #class beautify-sub kill;

    #var beautify-switch {OFF};
    warnLog å®½å­—ç¬¦ç¾åŒ–å·²ç¦ç”¨ã€‚ä½ å¯ä»¥é€šè¿‡å¿«æ·é”®æˆ–è€… beautify.On é‡æ–°å¯ç”¨ã€‚;

    prompt.Set {{beautify}{<110>å·²ç¦ç”¨}};
    prompt.refresh;
};

#function {Beautify} {
    #local text {%1};

    #if { "${beautify-switch}" != "ON" } {
        #return {$text};
    };

    #local charset {};
    #foreach {*{beautify-table[]}} {charset} {
        #local type {${beautify-table[$charset]}};
        #switch {"$type"} {
            #case {"double"}        {#replace {text} {{$charset}} {&1&1}};
            #case {"left-align"}    {#replace {text} {{$charset}} {&1 }};
            #case {"right-align"}   {#replace {text} {{$charset}} { &1}};
            #default                {#line sub var #replace {text} {{$charset}} {&1$type}};
        };
    };

    #return {$text};
};

#alias {beautify.SetEolMark} {
    #local mark {%1};

    #if { "$mark" == "" } {
        #local mark {<g03>.};
    };

    #var beautify-eol-mark {$mark};
};

#alias {beautify.ToggleSwitch} {
    #if { "${beautify-switch}" == "ON" } {
        beautify.Off;
    };
    #else {
        beautify.On;
    };
};
