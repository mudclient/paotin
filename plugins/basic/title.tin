#nop å¼€å¯ PCRE UTF å­—ç¬¦ç±»æ”¯æŒã€‚;
#config {PCRE UTF} ON;

#nop ã€ä¸€ä»£ç¥ç›¸ã€‘æ±Ÿæ¹–åå¤§æ°”è¡€é«˜æ‰‹ ç‰›è‚‰é¢é¦† æ€»ç®¡äº‹ã€Œç»å¯¹ä¸æ˜¯ã€å¤©å¤©ç»ƒåŠŸ ğŸ’ â˜¯ï¸ (Marking);
#nop ã€ è¥¿  æ¯’ ã€‘æ¡ƒæ—ä¹¦é™¢ ç”Ÿå‘˜ã€Œå–µå–µå–µå–µå–µå–µå–µå–µå–µå–µå–µå–µå–µå–µå–µå–µã€æŒ–ç…¤çŒ« ğŸ â­•ï¸ (Zardc);
#nop             æœ±é›€ è¾½ä¸œå¤§ä¾  èƒ¡ä¸€åˆ€(Hu yidao) [ä»»åŠ¡å‘æ”¾] â—†â—† <è¡£é’µç›¸æ‰¿>;
#nop             ä¸å¸®ç¬¬å…«ä»£å¸®ä¸» è§å³°(Xiao feng) [ä»»åŠ¡å‘æ”¾] â—†;
#nop             å¤§å–„äºº éŸ©å‘˜å¤–(Han yuanwai) [ä»»åŠ¡å‘æ”¾];
#function {ParseTitle} {
    #local obj {%0};

    #nop å°æŠ€å·§ï¼šreplace åŒ¹é…ä¹‹å‰ä¸ä¼šå°† &1~&99 æ¸…ç©ºï¼Œå› æ­¤åŒ¹é…å¯é€‰é¡¹æ—¶ä¼šä¿ç•™ä¸Šä¸€æ¬¡çš„å€¼ã€‚;
    #nop æ‰€ä»¥è¿™é‡Œæ‰‹åŠ¨æ¸…ç©ºä¸€ä¸‹;
    #local tmp {};
    #replace {tmp} {%s%s%s%s%s%s%s%s%s%s} {};

    #replace {obj} {^{?:(?:ã€(.+?)ã€‘)?(.*?)(?:ã€Œ(.+?)ã€)?(\p{Han}+)( (?:\p{So}\S* )+)?\(([A-Z][a-z']+(?: [a-z]+)*)\)(?: <(.*?)>)?(?: \[(.*?)\])?(?: ((?:â—†)+))?(?: <(è¡£é’µç›¸æ‰¿)>)?}$} {
        {rank}      {@trim{&1}}
        {title}     {@trim{&2}}
        {nick}      {@trim{&3}}
        {name}      {&4}
        {emoji}     {@trim{&5}}
        {id}        {@toLower{&6}}
        {status1}   {&7}
        {status2}   {&8}
        {isJobNPC}  {&9}
        {yibo}      {&10}
    };

    #nop æ³¨æ„ #replace åˆšæ›¿æ¢å®Œæ—¶ï¼Œå¾—åˆ°çš„æ˜¯å­—ç¬¦ä¸²ï¼Œæœ€åè¿˜è¦å†è¿›è¡Œä¸€æ¬¡èµ‹å€¼ï¼Œæ‰èƒ½å¤Ÿå°†å®ƒç»“æ„åŒ–;
    #local obj {$obj};

    #if { "$obj[name]" == "" } {
        #return {};
    };

    #if { "$obj[title]" == "â˜†%S%s%Sâ˜†" } {
        #local partyInfo {$obj[title]};
        #replace partyInfo {^â˜†%S%s%Sâ˜†$} {{party}{&1}{partyRank}{&3}};
        #local partyInfo {$partyInfo};
        #local obj[title] {$partyInfo[party];$partyInfo[partyRank]};
        #local obj[party] {$partyInfo[party]};
        #local obj[partyRank] {$partyInfo[partyRank]};
    };

    #replace obj[title] {%+1..s} {;};
    #replace obj[emoji] {%+1..s} {;};
    #replace obj[rank]  {%+1..s} {};

    #local field {};
    #foreach {rank;title;nick;name;emoji;id;status1;status2;isJobNPC;yibo} {field} {
        #if { "$obj[$field]" == "" } {
            #unlocal obj[$field];
        };
    };

    #return {$obj};
};
